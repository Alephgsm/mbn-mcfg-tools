# MBN File Format

## MBN Secure Boot Segment

### Header V3

```
+--------+--------+--------+--------+
|             image id              |
+--------+--------+--------+--------+
|           version (= 3)           |
+--------+--------+--------+--------+
|           flash address           |
+--------+--------+--------+--------+
|        destination address        |
+--------+--------+--------+--------+
|           total length            |
+--------+--------+--------+--------+
|            hash length            |
+--------+--------+--------+--------+
|         signature address         |
+--------+--------+--------+--------+
|         signature length          |
+--------+--------+--------+--------+
|     certificate chain address     |
+--------+--------+--------+--------+
|     certificate chain length      |
+--------+--------+--------+--------+
```

### Header V5

```
+--------+--------+--------+--------+
|             image id              |
+--------+--------+--------+--------+
|           version (= 5)           |
+--------+--------+--------+--------+
|      signature size qualcomm      |
+--------+--------+--------+--------+
|  certificate chain size qualcomm  |
+--------+--------+--------+--------+
|           total length            |
+--------+--------+--------+--------+
|            hash length            |
+--------+--------+--------+--------+
|         signature address         |
+--------+--------+--------+--------+
|         signature length          |
+--------+--------+--------+--------+
|     certificate chain address     |
+--------+--------+--------+--------+
|     certificate chain length      |
+--------+--------+--------+--------+
```

### Header V6

```
+--------+--------+--------+--------+
|             image id              |
+--------+--------+--------+--------+
|           version (= 6)           |
+--------+--------+--------+--------+
|      signature size qualcomm      |
+--------+--------+--------+--------+
|  certificate chain size qualcomm  |
+--------+--------+--------+--------+
|           total length            |
+--------+--------+--------+--------+
|            hash length            |
+--------+--------+--------+--------+
|         signature address         |
+--------+--------+--------+--------+
|         signature length          |
+--------+--------+--------+--------+
|     certificate chain address     |
+--------+--------+--------+--------+
|     certificate chain length      |
+--------+--------+--------+--------+
|     qualcomm metadata length      |
+--------+--------+--------+--------+
|          metadata length          |
+--------+--------+--------+--------+
```


## MCFG Segment Format

```
    1        2        3        4
+--------+--------+--------+--------+
|  "M"   |  "C"   |  "F"   |  "G"   |
+--------+--------+--------+--------+
|   format_type   |   config type   |
+--------+--------+--------+--------+
|  number of items in MCFG segment  |
+--------+--------+--------+--------+
|  carrier index  |    reserved     |
+--------+--------+--------+--------+
|   version id    |  version size   |
+--------+--------+--------+--------+
|                                   :
:              version              :
:                                   |
+--------+--------+--------+--------+
|                                   :
:               Items               :
:                                   |
+--------+--------+--------+--------+
|                                   :
:           Trailer Item            :
:                                   |
+--------+--------+--------+--------+
```

### MCFG Item Format

```
+--------+--------+--------+--------+
|              length               |
+--------+--------+--------+--------+
|  type  | attrs  |    reserved     |
+--------+--------+--------+--------+
|                                   :
:               data                :
:                                   |
+--------+--------+--------+--------+
```

#### NV Item (Type == 1) Format

```
+--------+--------+--------+--------+
|      NV ID      |     length      |
+--------+--------+--------+--------+
|                                   :
:               data                :
:                                   |
+--------+--------+--------+--------+
```

#### NV File Item (Type == 2/4) Format

```
+--------+--------+--------+--------+
|              length               |
+--------+--------+--------+--------+
|  type  | attrs  |    reserved     |
+--------+--------+--------+--------+
|   magic (0x1)   |   path length   |
+--------+--------+--------+--------+
|                                   :
:             file path             :
:                                   |
+--------+--------+--------+--------+
|   magic (0x2)   |     length      |
+--------+--------+--------+--------+
|                                   :
:               data                :
:                                   |
+--------+--------+--------+--------+
```

### MCFG Trailer Format


```
+--------+--------+--------+--------+
|              length               |
+--------+--------+--------+--------+
|   magic (0xa)   |    reserved     |
+--------+--------+--------+--------+
|  magic2 (0xa1)  | content length  |
+--------+--------+--------+--------+
|  "M"   |  "C"   |  "F"   |  "G"   |
+--------+--------+--------+--------+
|  "_"   |  "T"   |  "R"   | "L"    |
+--------+--------+--------+--------+
|                                   :
:           trailer items           :
:                                   |
+--------+--------+--------+--------+
```

#### Trailer Item Format

```
+--------+--------+--------+--------+
|  type  |     length      |        :
+--------+--------+--------+        :
|                                   :
:               value               :
:                                   |
+--------+--------+--------+--------+
```

